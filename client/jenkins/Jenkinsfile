pipeline {
    agent {
        docker {
            image 'node:lts-buster-slim'
            args '-p 3000:3001 -u root'
        }
    }
    stages {
        stage('Install Dependencies for FE and BE') {
            steps {
                            sh "cd client && npm install"
                            sh "cd server && npm install"
                        }
        }
        stage('Test FE') {
            steps {
                sh "chmod +x -R ${env.WORKSPACE}"
                sh './client/jenkins/scripts/testFE.sh'
            }
        }
        stage('Test BE') {
                    steps {
                        sh "chmod +x -R ${env.WORKSPACE}"
                        sh './client/jenkins/scripts/testBE.sh'
                    }
                }
        stage('Deploy FE') {
             steps {
                            sh '''
                                curl https://cli-assets.heroku.com/install.sh | sh;
                                heroku login
                                heroku git:remote -a w2w-front
                                git subtree push --prefix client/ heroku main
                            '''
                }
        }
        stage('Deploy BE') {
                 steps {
                                             sh '''
                                                 heroku login
                                                 heroku git:remote -a w2w-back
                                                 git subtree push --prefix server/ heroku main
                                             '''
                                 }
                }
    }
}
